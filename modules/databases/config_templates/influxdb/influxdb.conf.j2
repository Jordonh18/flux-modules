# InfluxDB Configuration Template
# Generated by Flux Databases Module
# Memory: {{ memory_mb }}MB | CPUs: {{ cpus }} | Storage: {{ storage_gb }}GB

### [meta]
[meta]
  dir = "{{ data_dir }}/meta"
  retention-autocreate = true
  logging-enabled = true

### [data]
[data]
  dir = "{{ data_dir }}/data"
  wal-dir = "{{ data_dir }}/wal"
  wal-fsync-delay = "0s"
  
  # Query and compaction settings
  query-log-enabled = true
  cache-max-memory-size = {{ (memory_mb * 1024 * 1024 * 0.25)|int }}
  cache-snapshot-memory-size = {{ (memory_mb * 1024 * 1024 * 0.05)|int }}
  cache-snapshot-write-cold-duration = "10m0s"
  
  # Compaction settings
  compact-full-write-cold-duration = "4h0m0s"
  compact-throughput = "48m"
  compact-throughput-burst = "48m"
  max-concurrent-compactions = {{ (cpus / 2)|int if cpus > 1 else 1 }}
  
  # TSM Engine Settings
  max-series-per-database = 1000000
  max-values-per-tag = 100000
  max-index-log-file-size = "1m"
  series-id-set-cache-size = 100

### [coordinator]
[coordinator]
  write-timeout = "10s"
  max-concurrent-queries = {{ max_connections }}
  query-timeout = "0s"
  log-queries-after = "0s"
  max-select-point = 0
  max-select-series = 0
  max-select-buckets = 0

### [retention]
[retention]
  enabled = true
  check-interval = "30m0s"

### [shard-precreation]
[shard-precreation]
  enabled = true
  check-interval = "10m0s"
  advance-period = "30m0s"

### [monitor]
[monitor]
  store-enabled = true
  store-database = "_internal"
  store-interval = "10s"

### [http]
[http]
  enabled = true
  bind-address = ":{{ port }}"
  auth-enabled = false
  log-enabled = true
  suppress-write-log = false
  access-log-path = "{{ log_dir }}/access.log"
  access-log-status-filters = []
  write-tracing = false
  pprof-enabled = true
  pprof-auth-enabled = false
  debug-pprof-enabled = false
  ping-auth-enabled = false
  https-enabled = {{ 'true' if tls_enabled else 'false' }}
{% if tls_enabled %}
  https-certificate = "{{ tls_cert_path }}"
  https-private-key = "{{ tls_key_path }}"
{% endif %}
  shared-secret = ""
  max-row-limit = 0
  max-connection-limit = 0
  unix-socket-enabled = false
  bind-socket = "/var/run/influxdb.sock"
  max-body-size = {{ (memory_mb * 1024 * 1024 * 0.1)|int }}
  max-concurrent-write-limit = 0
  max-enqueued-write-limit = 0
  enqueued-write-timeout = 30000000000

### [logging]
[logging]
  format = "auto"
  level = "info"
  suppress-logo = false

### [subscriber]
[subscriber]
  enabled = true
  http-timeout = "30s"
  insecure-skip-verify = false
  ca-certs = ""
  write-concurrency = 40
  write-buffer-size = 1000

### [[graphite]]
[[graphite]]
  enabled = false

### [[collectd]]
[[collectd]]
  enabled = false

### [[opentsdb]]
[[opentsdb]]
  enabled = false

### [[udp]]
[[udp]]
  enabled = false

### [continuous_queries]
[continuous_queries]
  log-enabled = true
  enabled = true
  query-stats-enabled = false
  run-interval = "1s"

### [tls]
{% if tls_enabled %}
[tls]
  ciphers = [
    "TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305",
    "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
    "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256",
    "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384",
    "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384",
    "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256",
    "TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256",
  ]
  min-version = "tls1.2"
  max-version = "tls1.3"
{% endif %}
